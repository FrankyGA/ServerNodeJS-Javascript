<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personajes de Harry Potter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1>Personajes de Harry Potter</h1>
        <table class="table mt-3">
            <thead>
                <tr>
                    <th>Imagen</th>
                    <th>Nombre</th>
                    <th>Especie</th>
                    <th>Género</th>
                    <th>Casa</th>
                    <th>Año de nacimiento</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-personajes">
                <!-- Los datos de los personajes se mostrarán aquí -->
            </tbody>
        </table>
        <div class="mt-3">
            <!-- Botones para filtrar personajes -->
            <button class="btn btn-primary" onclick="window.location.href = '/personajes'">Mostrar todos</button>
            <button class="btn btn-primary" onclick="window.location.href = '/filtro1'">Filtro 1</button>
            <button class="btn btn-primary" onclick="window.location.href = '/filtro2'">Filtro 2</button>
            <button class="btn btn-primary" onclick="window.location.href = '/filtro3'">Filtro 3</button>
            <button class="btn btn-primary" onclick="window.location.href = '/filtro4'">Filtro 4</button>
        </div>


        <div class="container mt-3">
            <div class="row">
                <!-- Formulario para añadir un nuevo personaje -->
                <form id="formularioNuevoPersonaje">
                    <div class="mb-3">
                        <label for="image" class="form-label">Imagen URL:</label>
                        <input type="text" class="form-control" id="image" name="image" required>
                    </div>
                    <div class="mb-3">
                        <label for="name" class="form-label">Nombre:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="species" class="form-label">Especie:</label>
                        <input type="text" class="form-control" id="species" name="species" required>
                    </div>
                    <div class="mb-3">
                        <label for="gender" class="form-label">Género:</label>
                        <input type="text" class="form-control" id="gender" name="gender" required>
                    </div>
                    <div class="mb-3">
                        <label for="house" class="form-label">Casa:</label>
                        <input type="text" class="form-control" id="house" name="house" required>
                    </div>
                    <div class="mb-3">
                        <label for="yearOfBirth" class="form-label">Año de nacimiento:</label>
                        <input type="number" class="form-control" id="yearOfBirth" name="yearOfBirth" required>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar</button>
                </form>
            </div>
        </div>
    </div>
    <script>

        // Función para insertar personaje, manda petición al servidor
        document.getElementById("formularioNuevoPersonaje").addEventListener("submit", async function (event) {
            event.preventDefault(); // Evitar que el formulario se envíe por defecto

            // Obtener los datos del formulario
            let formData = {
                // Recogemos los valores de los elementos del formulario
                image: document.getElementById("image").value,
                name: document.getElementById("name").value,
                species: document.getElementById("species").value,
                gender: document.getElementById("gender").value,
                house: document.getElementById("house").value,
                yearOfBirth: parseInt(document.getElementById("yearOfBirth").value)
            };

            try {
                // Enviar los datos al servidor para guardar el nuevo personaje
                let respuesta = await fetch("/guardarPersonaje", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json" // Se indica que el cuerpo de la solicitud es JSON
                    },
                    body: JSON.stringify(formData) // Convertir el objeto a JSON antes de enviarlo
                });

                if (respuesta.ok) {
                    // Mostrar una alerta de Bootstrap indicando que se guardó el nuevo personaje
                    alert("Nuevo personaje guardado correctamente");
                    // Redirigir al usuario a la página de personajes después de guardar el nuevo personaje
                    window.location.href = '/personajes';
                } else {
                    alert("Error al guardar el nuevo personaje");
                }
            } catch (error) {
                console.error("Error al guardar el nuevo personaje:", error);
                alert("Error al guardar el nuevo personaje");
            }
        });



        // Función para manejar el clic en el botón de borrar
        async function confirmarBorrado(personajeId) {
            if (confirm("¿Estás seguro de eliminar este personaje?")) {
                borrarPersonaje(personajeId);
            }
        }

        // Función para mandar la solicitud de borrado al servidor
        async function borrarPersonaje(personajeId) {
            try {
                // Realiza una solicitud DELETE al servidor para eliminar el personaje
                let respuesta = await fetch(`/eliminarPersonaje?id=${personajeId}`, {
                    method: "DELETE"
                });

                if (respuesta.ok) {
                    // Recarga la página después de eliminar el personaje
                    location.reload();
                } else {
                    console.error("Error al eliminar el personaje:", respuesta.statusText);
                    alert("Error al eliminar el personaje");
                }
            } catch (error) {
                console.error("Error al eliminar el personaje:", error);
                alert("Error al eliminar el personaje");
            }
        }
    </script>
</body>

</html>